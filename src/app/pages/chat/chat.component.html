<app-header></app-header>
<div class="chat-container">
  <!-- Sidebar -->
  <div class="sidebar" [class.sidebar--open]="sidebarOpen">
    <div class="sidebar__header">
      <h2 class="sidebar__title">Chat History</h2>
      <button class="btn-new" (click)="createNewChat()" title="New Chat">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>
    </div>

    <div class="sidebar__channels">
      <div 
        *ngFor="let channel of channels" 
        class="channel-item"
        [class.channel-item--active]="activeChannelId === channel.id"
        (click)="loadChannel(channel.id)"
      >
        <div class="channel-item__icon">ğŸ’¬</div>
        <div class="channel-item__content">
          <div class="channel-item__title">{{ channel.title || 'New Chat' }}</div>
          <div class="channel-item__time">{{ formatTimestamp(channel.timestamp) }}</div>
        </div>
      </div>

      <div *ngIf="channels.length === 0" class="sidebar__empty">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ’¬</div>
        <p style="font-size: 0.875rem;">No chat history yet</p>
        <p style="font-size: 0.75rem; margin-top: 0.25rem;">Start a new conversation!</p>
      </div>
    </div>
  </div>

  <!-- Sidebar Overlay -->
  <div 
    class="sidebar-overlay" 
    [class.sidebar-overlay--active]="sidebarOpen && isMobile"
    (click)="toggleSidebar()"
  ></div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Header -->
    <div class="header">
      <button class="btn-menu" (click)="toggleSidebar()" title="Toggle Menu">
        <svg *ngIf="!sidebarOpen" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
        <svg *ngIf="sidebarOpen" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <h1 class="header__title">AI Assistant</h1>
    </div>

    <!-- Messages Area -->
    <div class="messages" #messagesContainer>
      <div *ngIf="messages.length === 0 && !isProcessing" class="messages__empty">
        <div class="empty-icon">ğŸ¤–</div>
        <p class="empty-text">How can I help you today?</p>
        <p style="color: var(--text-light); font-size: 0.875rem; margin-top: 0.25rem;">
          Ask me anything or upload files for analysis
        </p>
      </div>

      <div *ngFor="let message of messages" class="message" 
           [class.message--user]="message.isUser" 
           [class.message--assistant]="!message.isUser">
        
        <div class="message__avatar">
          <span *ngIf="message.isUser">ğŸ‘¤</span>
          <span *ngIf="!message.isUser">ğŸ¤–</span>
        </div>

        <div class="message__content">
          <!-- Text -->
          <div class="message__bubble" *ngIf="message.text">
            <span *ngIf="!message.isLoading">{{ message.text }}</span>
            <div *ngIf="message.isLoading" class="typing-indicator">
              <span></span><span></span><span></span>
            </div>
          </div>

          <!-- Files -->
          <div class="message__files" *ngIf="message.files && message.files.length > 0">
            <div *ngFor="let file of message.files" class="file-item">
              <img *ngIf="isImageFile(file)" [src]="message.fileUrls![file.name]" alt="Preview" class="file-item__img"/>
              <div *ngIf="!isImageFile(file)" class="file-item__icon">ğŸ“</div>
              <div class="file-item__info">
                <div class="file-item__name">{{ file.name }}</div>
                <div class="file-item__size">{{ formatFileSize(file.size) }}</div>
              </div>
            </div>
          </div>

          <!-- Feedback buttons -->
          <div *ngIf="!message.isUser && !message.isLoading" class="message__actions">
            <button class="action-btn" (click)="copyMessage(message)" title="Copy">
              ğŸ“‹
            </button>
            <button class="action-btn" 
                    [class.action-btn--active]="getFeedbackLiked(message.id)" 
                    (click)="toggleFeedback(message.id, true)" 
                    title="Like">
              ğŸ‘
            </button>
            <button class="action-btn" 
                    [class.action-btn--active]="getFeedbackDisliked(message.id)" 
                    (click)="toggleFeedback(message.id, false)" 
                    title="Dislike">
              ğŸ‘
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="input-area" 
         (drop)="onDrop($event)" 
         (dragover)="onDragOver($event)" 
         (dragleave)="onDragLeave($event)"
         [class.drag-over]="isDragOver">

      <!-- File Previews -->
      <div *ngIf="selectedFiles.length > 0" class="file-previews">
        <div *ngFor="let file of selectedFiles; let i = index" class="file-preview">
          <img *ngIf="isImageFile(file)" [src]="createPreviewUrl(file)" alt="Preview" class="file-preview__img"/>
          <div *ngIf="!isImageFile(file)" class="file-preview__icon">ğŸ“</div>
          <div class="file-preview__info">
            <div class="file-preview__name">{{ file.name }}</div>
            <div class="file-preview__size">{{ formatFileSize(file.size) }}</div>
          </div>
          <button class="file-preview__remove" (click)="removeSelectedFile(i)" title="Remove file">Ã—</button>
        </div>
      </div>

      <!-- Input Box -->
      <div class="input-box">
        <input type="file" #fileInput multiple (change)="onFileSelected($event)" hidden accept="*/*">
        
        <button class="btn-attach" 
                (click)="fileInput.click()" 
                [disabled]="isProcessing"
                title="Attach files">
          ğŸ“
        </button>

        <input type="text" 
               class="input-box__field" 
               placeholder="Type your message..." 
               [(ngModel)]="userQuery"
               (keydown)="handleKeyPress($event)"
               [disabled]="isProcessing"
               #textInput>

        <button class="btn-send" 
                (click)="onSubmitQuery()" 
                [disabled]="(!userQuery.trim() && selectedFiles.length === 0) || isProcessing"
                title="Send message">
          {{ isProcessing ? 'â³' : 'â¤' }}
        </button>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>